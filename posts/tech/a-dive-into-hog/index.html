<!DOCTYPE html>
<html lang='en' class="js csstransforms3d">
  <head>
    <title>Thuyen&#39;s corner</title>
<link rel="icon" href="/favicon.png" type="image/png">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta property="og:title" content="A dive into Histogram of Oriented Gradients (HOG)" />
<meta property="og:description" content="In this post, we will dive into Histogram of Oriented Gradients (HOG), a common technique used to extract features of images&hellip; And then implement it in python (in order to comprehend it)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://trinhngocthuyen.com/posts/tech/a-dive-into-hog/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-07-13T00:00:00+00:00" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
<link rel="stylesheet" href="/sass/main.a62d641be28ef130e4befc9ae1488020617bf33198d55fd2ffe4ab8010fcf11c.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://kit.fontawesome.com/b0896cba62.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-VWZ70X3N46"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-VWZ70X3N46', { 'anonymize_ip': false });
}
</script>

  </head>
  <body class="" data-url="/posts/tech/a-dive-into-hog/">
    <nav role="navigation">
  <header class="banner">
    <h1 class="logo">
      <a href="/"><span class="first">üè† THUYEN's</span> <span class="second">corner</span></a>
    </h1>
    <div id="menu-toggle" class="menu-toggle">
      <svg class="icon"  viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true">
        <line x1="0" y1="50%" x2="100%" y2="50%"/>
        <line x1="0" y1="50%" x2="100%" y2="50%"/>
        <line x1="0" y1="50%" x2="100%" y2="50%"/>
      </svg>
    </div>
  </header>
  <ul class="menu-items">
    <li class="menu-item"><a href="/posts/tech">Tech Blog</a></li>
    <li class="menu-item"><a href="/posts/misc">T·∫°p B√∫t</a></li>
    <li class="menu-item"><a href="/projects">Projects</a></li>
    <li class="menu-item"><a href="/about">About</a></li>
  </ul>
</nav>

<script src="/scripts/menu.js"></script>
    <main role="main">
<div class="page-wrapper">
<article class="page">
  <header>
  
  <h1>A dive into Histogram of Oriented Gradients (HOG)</h1>
  
  
  <div class="metadata">
  <span>2017, Jul 13</span>
</div>
  
</header>
  <p>In this post, we will dive into Histogram of Oriented Gradients (HOG), a common technique used to extract features of images&hellip; And then implement it in python (in order to comprehend it).</p>
<h3 id="feature-descriptor">Feature Descriptor</h3>
<p>A <em>feature descriptor</em> is a representation of an image (or image patch) simplifying the image by extracting useful information and throwing away irrelevant information.</p>
<p>A <em>feature descriptor</em> converts an image of size $W \times H \times 3$ to a feature vector of length $N$</p>
<h4 id="what-is-considered-_useful_">What is considered <em>useful</em>?</h4>
<p>It depends on purpose. For example, it might not be good for image viewing, but for classification since using it produces good results.</p>
<p>In the HOG feature descriptor, the distribution (histograms) of directions of gradients (oriented gradients) are used as features. Gradients of an image are useful because the mangitude of gradients is large around edges and corners which contain a lot more information about object shape than flat regions.</p>
<h3 id="how-to-calculate-hog">How to calculate HOG?</h3>
<p>P/s: To make sure the calculation is correctly, we will compare the result of our manual implementation with that of <code>skimage</code>.</p>
<h4 id="step1-preprocessing-images">Step1: Preprocessing images</h4>
<ul>
<li>Crop image (if needed). Here, I use an image of size $512 \times 512$ (from skimage)</li>
<li>Convert to grayscale</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">data</span><span class="p">,</span> <span class="n">color</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">original_image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">astronaut</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">rgb2gray</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">astronaut</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;original: </span><span class="si">%s</span><span class="s2"> --&gt; grayscale: </span><span class="si">%s</span><span class="s2">&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">original_image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</span></span></code></pre></div><pre><code>0.44195368474
original: (512, 512, 3) --&gt; grayscale: (512, 512)
</code></pre>
<h4 id="step-2-compute-gradient-images">Step 2: Compute gradient images</h4>
<ul>
<li>The gradients involve gradients by x axis (indicating horizontal change) and gradients by y axis (vertical change)</li>
<li>$g_x, g_y \in \mathbf{R}^{H \times W}$</li>
</ul>
<p>Note that we calculate the gradient using the approximation for discrete value:
$f&rsquo;(x) \approx \frac{f(x+h) - f(x)}{h}$.</p>
<p>The smallest value of $h$ is 1, corresponding to 1 pixel. In fact, this approximation is called <em>forward difference</em>. We also have other candidates to approximate the gradient as follows:</p>
<ul>
<li>Backward difference: $f&rsquo;(x) = f(x) - f(x-1)$</li>
<li>Forward difference: $f&rsquo;(x) = f(x+1) - f(x)$ (like above)</li>
<li>Central difference: $f&rsquo;(x) = \frac{f(x+1) - f(x-1)}{2}$</li>
</ul>
<p>In this post, I will use three of them: backward/forward difference for the edge pixels, central difference for rest. Some approaches do not care about the 4 edges and set them to zero.</p>
<p>However, I use the three approximations above because it is consistent with the implementation of <code>np.gradient()</code> which is a <em>standardly correct function</em> I can use to check my own code. Another reason is that <code>skimage.feature.hog</code> is implemented in the same way. I will be able to compare my result with that computed by <code>skimage</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">compute_gradient</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Compute gradient of an image by rows and columns
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">gx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">gy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Central difference</span>
</span></span><span class="line"><span class="cl">    <span class="n">gx</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">image</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="n">gy</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">image</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Forward difference</span>
</span></span><span class="line"><span class="cl">    <span class="n">gx</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">gy</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Backward difference</span>
</span></span><span class="line"><span class="cl">    <span class="n">gx</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">gy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">image</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">gx</span><span class="p">,</span> <span class="n">gy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span> <span class="o">=</span> <span class="n">compute_gradient</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check with np.gradient()</span>
</span></span><span class="line"><span class="cl"><span class="n">gy_check</span><span class="p">,</span> <span class="n">gx_check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="c1"># Note that the result of np.gradient is in the reversed order</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;diff_gx:&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">gx</span> <span class="o">-</span> <span class="n">gx_check</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;diff_gy&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">gy</span> <span class="o">-</span> <span class="n">gy_check</span><span class="p">))</span>
</span></span></code></pre></div><pre><code>diff_gx: 0.0
diff_gy 0.0
</code></pre>
<p>Now let&rsquo;s see what information $g_x$ and $g_y$ carry.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gradient gx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">gy</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gradient gy&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gx</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gradient abs(gx)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">))</span> <span class="c1"># np.hypo(gx, gy) = np.sqrt(gx**2 + gy**2)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gradient sqrt(gx^2 + gy^2)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><img src="/images/notebooks/hog_8_0.png"/>
<p>Basically, $gx$ and $gy$ represent the edges of objects pretty well. We could intuitively think that changes in pixel values occur almost and significantly at object edges.</p>
<p>We could understand the gradients as a set of vectors $\vec{d} = \vec{dx} + \vec{dy}$, each of which is associated with a pixel $(x, y)$.</p>
<p>üìù Note:</p>
<ul>
<li>The visualizations of $gx$ and $gy$ are almost gray because they have negative values which turn the regions with zero gradient to neutral gray. The unsigned gradient (ie. $\lvert g_x \lvert, \lvert g_y \lvert$) of them should produce the very similar results as the rightmost image.</li>
</ul>
<h4 id="step-3-compute-hog-in-each-cell">Step 3: Compute HOG in each cell</h4>
<p>The edges above somehow resemble the sketch of the object, but quite smoother. In practice, <em>rough sketch</em> is good enough to classify objects. Therefore, we will only care just a few orientations of $\vec{d}$ and in local regions (rather than every pixel).</p>
<p>We divide the image into many cells of size ($8 \times 8$). These cells are also usually called <em><strong>patches</strong></em>. In this example, the size of the image is ($512 \times 512$), so we have ($64 \times 64$) patches in total. Oh, don&rsquo;t forget to divide the total magnitudes in each bin by the number of pixels per patch.</p>
<p><img src="/images/notebooks/hog_austronaut_patches.png" width="300px"/>
<figcaption>The yellow square is a cell ($8 \times 8$). The red one is a block of 4 cells.</figcaption></p>
<p>For each patch, we extract a vector of 9 bins (corresponding to angles $20^\circ, 40^\circ, &hellip;, 160^\circ$). A pixel that has orientation $95^\circ$, magnitude $1.5$ should add up an amount of $1.5$ to the bin $80^\circ$.</p>
<p><img src="/images/notebooks/hog_mag_ori.png" width="600px"/>
<figcaption>Magnitudes (upper values) and orientations in degree (in blue and white). In the right figure, the orientations are rounded to the pivot values of 9 bins (0, 20, 40, &hellip;, 160).</figcaption></p>
<p>This vector gives information about the statistic of the how popular each considered orientation is <em>(ie. the distribution of orientations)</em>. For example, a vector $v = (12, 0, 0.1, 0.7, 0.2, 0, 0, 0, 0.1)$ indicates the frequent appearance of horizontal strokes.</p>
<p><img src="/images/notebooks/hog_patch_hist.png" width="300px"/>
<figcaption>From the histogram of the patch, we notice that distribution of orientation of 40 degree is high, indicating that most strokes are drawn diagonally.</figcaption></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">compute_hog_cell</span><span class="p">(</span><span class="n">n_orientations</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">magnitudes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">orientations</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Compute 1 HOG feature of a cell. Return a row vector of size `n_orientations`
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">bin_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">n_orientations</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">hog</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_orientations</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">orientations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">orientations</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">            <span class="n">orientation</span> <span class="o">=</span> <span class="n">orientations</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">lower_bin_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">orientation</span> <span class="o">/</span> <span class="n">bin_width</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">hog</span><span class="p">[</span><span class="n">lower_bin_idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">magnitudes</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">hog</span> <span class="o">/</span> <span class="p">(</span><span class="n">magnitudes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">magnitudes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span></code></pre></div><h4 id="step-4-block-normalization">Step 4: Block normalization</h4>
<p>Up to this step, we have created a histogram based on the gradients of the image. However, the gradients are sensitive to illumination. For example, if we darken the image by a half of light, the gradient magnitudes will decrease twice which means the histogram values change by half. A practical way to alleviate this dependence is normalizing the histogram.</p>
<p>We could perform normalization in larger regions. This stage is called <em><strong>block normalization</strong></em>. For example, we could take a block of 4 (square aligned) cells to normalize and take the result as a final histogram feature. We slide to the right and then down to get histogram features for other blocks.</p>
<p>üìù Note:</p>
<ul>
<li>These blocks could overlap each other.</li>
<li>Each histogram of a block is a row vector of size 36 (4 cells/block)</li>
</ul>
<p>In this examples, with 4 cells/block, there are $63 \times 63$ blocks. So, we $63 \times 63$ histogram vectors of size 36.</p>
<p>$\implies 63 \times 63 \times 36 = 142884$ numbers</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">normalize_vector</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Return a normalized vector (which has norm2 as 1) 
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># eps is used to prevent zero divide exceptions (in case v is zero)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">v</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">v</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">compute_hog_features</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                         <span class="n">n_orientations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">pixels_per_cell</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                         <span class="n">cells_per_block</span><span class="p">:</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Compute HOG features of an image. Return a row vector
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">gx</span><span class="p">,</span> <span class="n">gy</span> <span class="o">=</span> <span class="n">compute_gradient</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sy</span><span class="p">,</span> <span class="n">sx</span> <span class="o">=</span> <span class="n">gx</span><span class="o">.</span><span class="n">shape</span>
</span></span><span class="line"><span class="cl">    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">pixels_per_cell</span>
</span></span><span class="line"><span class="cl">    <span class="n">bx</span><span class="p">,</span> <span class="n">by</span> <span class="o">=</span> <span class="n">cells_per_block</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">magnitudes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">gx</span><span class="p">,</span> <span class="n">gy</span><span class="p">)</span>   <span class="c1"># = np.sqrt(gx**2 + gy**2)</span>
</span></span><span class="line"><span class="cl">    <span class="n">orientations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">gy</span><span class="p">,</span> <span class="n">gx</span><span class="p">))</span> <span class="o">%</span> <span class="mi">180</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">n_cellsx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sx</span> <span class="o">/</span> <span class="n">cx</span><span class="p">)</span> <span class="c1"># Number of cells in x axis</span>
</span></span><span class="line"><span class="cl">    <span class="n">n_cellsy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sy</span> <span class="o">/</span> <span class="n">cy</span><span class="p">)</span> <span class="c1"># Number of cells in y axis</span>
</span></span><span class="line"><span class="cl">    <span class="n">n_blocksx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_cellsx</span> <span class="o">-</span> <span class="n">bx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">n_blocksy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_cellsy</span> <span class="o">-</span> <span class="n">by</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">hog_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_cellsx</span><span class="p">,</span> <span class="n">n_cellsy</span><span class="p">,</span> <span class="n">n_orientations</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">prev_x</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Compute HOG of each cell</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">it_x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cellsx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">prev_y</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">it_y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_cellsy</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">magnitudes_patch</span> <span class="o">=</span> <span class="n">magnitudes</span><span class="p">[</span><span class="n">prev_y</span><span class="p">:</span><span class="n">prev_y</span> <span class="o">+</span> <span class="n">cy</span><span class="p">,</span> <span class="n">prev_x</span><span class="p">:</span><span class="n">prev_x</span> <span class="o">+</span> <span class="n">cx</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">orientations_patch</span> <span class="o">=</span> <span class="n">orientations</span><span class="p">[</span><span class="n">prev_y</span><span class="p">:</span><span class="n">prev_y</span> <span class="o">+</span> <span class="n">cy</span><span class="p">,</span> <span class="n">prev_x</span><span class="p">:</span><span class="n">prev_x</span> <span class="o">+</span> <span class="n">cx</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">hog_cells</span><span class="p">[</span><span class="n">it_y</span><span class="p">,</span> <span class="n">it_x</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_hog_cell</span><span class="p">(</span><span class="n">n_orientations</span><span class="p">,</span> <span class="n">magnitudes_patch</span><span class="p">,</span> <span class="n">orientations_patch</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">prev_y</span> <span class="o">+=</span> <span class="n">cy</span>
</span></span><span class="line"><span class="cl">        <span class="n">prev_x</span> <span class="o">+=</span> <span class="n">cx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">hog_blocks_normalized</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_blocksx</span><span class="p">,</span> <span class="n">n_blocksy</span><span class="p">,</span> <span class="n">n_orientations</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Normalize HOG by block</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">it_blocksx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_blocksx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">it_blocky</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_blocksy</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">hog_block</span> <span class="o">=</span> <span class="n">hog_cells</span><span class="p">[</span><span class="n">it_blocky</span><span class="p">:</span><span class="n">it_blocky</span> <span class="o">+</span> <span class="n">by</span><span class="p">,</span> <span class="n">it_blocksx</span><span class="p">:</span><span class="n">it_blocksx</span> <span class="o">+</span> <span class="n">bx</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">hog_blocks_normalized</span><span class="p">[</span><span class="n">it_blocky</span><span class="p">,</span> <span class="n">it_blocksx</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalize_vector</span><span class="p">(</span><span class="n">hog_block</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">hog_blocks_normalized</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Compare the results with skimage.feature.hog</span>
</span></span><span class="line"><span class="cl"><span class="n">hog_features</span> <span class="o">=</span> <span class="n">compute_hog_features</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pixels_per_cell</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">cells_per_block</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">skimage.feature</span> <span class="kn">import</span> <span class="n">hog</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">hog_features_check</span> <span class="o">=</span> <span class="n">hog</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span><span class="p">,</span> <span class="n">orientations</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">pixels_per_cell</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">cells_per_block</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">block_norm</span><span class="o">=</span><span class="s1">&#39;L2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">hog_features</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">hog_features_check</span><span class="o">.</span><span class="n">shape</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">hog_features</span><span class="p">,</span> <span class="n">hog_features_check</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">hog_features</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span></code></pre></div><pre><code>True
(36864,)
</code></pre>
<p>Now, visualize the HOG features. Actually, I do not implement it since it is a bit cumbersome to reconstruct the image from these histogram info. Instead, I use the available function <code>skimage.feature.hog</code> to plot the HOG image so that we could have a sense of its benefits.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">skimage.feature</span> <span class="kn">import</span> <span class="n">hog</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">_</span><span class="p">,</span> <span class="n">hog_image</span> <span class="o">=</span> <span class="n">hog</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span><span class="p">,</span> <span class="n">orientations</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">pixels_per_cell</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">cells_per_block</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">block_norm</span><span class="o">=</span><span class="s1">&#39;L2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">visualise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Input image&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">hog_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;HOG&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><img src="/images/notebooks/hog_16_0.png"/>
<h3 id="reference">Reference</h3>
<ol>
<li><a href="http://lear.inrialpes.fr/people/triggs/pubs/Dalal-cvpr05.pdf">http://lear.inrialpes.fr/people/triggs/pubs/Dalal-cvpr05.pdf</a></li>
<li><a href="http://www.learnopencv.com/histogram-of-oriented-gradients">http://www.learnopencv.com/histogram-of-oriented-gradients</a></li>
<li><a href="http://mccormickml.com/2013/05/09/hog-person-detector-tutorial">http://mccormickml.com/2013/05/09/hog-person-detector-tutorial</a></li>
</ol>
<p>Jupyter notebook: <a href="https://github.com/trinhngocthuyen/teach-myself-ml/blob/master/funda_ml/HOG.ipynb">here</a></p>

  <div class="entry-footer">
  
<div class="categories">
  <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>
</svg>

  <a href="/categories/tech" class="category">tech</a>
</div>
  
<div class="tags">
  <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
</svg>

  <a href="/tags/image-processing" class="tag">image-processing</a>
</div>
</div>
</article>
<nav id="toc">
<h4 class="toc-header">Table of Contents</h4>
<div><a href="#feature-descriptor" toc_id="feature-descriptor">Feature Descriptor</a></div><div class="toc-section">

<div><a href="#what-is-considered-_useful_" toc_id="what-is-considered-_useful_">What is considered <em>useful</em>?</a></div></div>
<div><a href="#how-to-calculate-hog" toc_id="how-to-calculate-hog">How to calculate HOG?</a></div><div class="toc-section">

<div><a href="#step1-preprocessing-images" toc_id="step1-preprocessing-images">Step1: Preprocessing images</a></div>
<div><a href="#step-2-compute-gradient-images" toc_id="step-2-compute-gradient-images">Step 2: Compute gradient images</a></div>
<div><a href="#step-3-compute-hog-in-each-cell" toc_id="step-3-compute-hog-in-each-cell">Step 3: Compute HOG in each cell</a></div>
<div><a href="#step-4-block-normalization" toc_id="step-4-block-normalization">Step 4: Block normalization</a></div></div>
<div><a href="#reference" toc_id="reference">Reference</a></div></nav><script src="/scripts/toc.js"></script>
</div>

<nav class='entry-nav'><div class='prev-entry'>
    <a href='/posts/tech/create-custom-xcode-templates/'>Create custom Xcode templates</a>
  </div><div class='next-entry'>
    <a href='/posts/tech/weight-initialization/'>Weight initialization - impact on layer distribution</a>
  </div></nav>

<section id='comments' class='comments'>
  <div class="container">
    
<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v17.0"></script>
<div class="share">
  <div class="fb-like" data-href="https://trinhngocthuyen.com/posts/tech/a-dive-into-hog/" data-width="" data-layout="standard" data-action="like" data-share="true"></div>
</div>
  </div>
  <div class="container">
    <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="trinhngocthuyen" data-color="#FFDD00" data-emoji=""  data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff" ></script>
  </div>
</section>

</main><script type='text/x-mathjax-config'>
  MathJax.Hub.Config({"HTML-CSS":{"availableFonts":["TeX"],"linebreaks":{"automatic":true},"scale":90},"TeX":{"Macros":{"dim":["{\\color{gray}#1}",1],"txt":["\\hspace{3pt}\\text{#1}\\hspace{3pt}",1]},"TagSide":"left","extensions":["color.js"]},"extensions":["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js"],"jax":["input/TeX","output/HTML-CSS"],"tex2jax":{"displayMath":[["$$","$$"]],"inlineMath":[["$","$"]],"processEnvironments":true,"processEscapes":true}})
</script>

<script type='text/javascript' async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML'></script></body>
</html>